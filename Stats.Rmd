---
title: "Stats"
output: html_document
---

# OA Stats

## Findings

Comparing the OA status information from Scopus and Unpaywall:

* The total OA counts were almost the same;
* The counts of specific OA status were different. If we could not quickly identify which source is more reliable, I suggested we use Scopus OA data because it is easier and less time-consuming to obtain.
* The **overall journal article OA percentage was 45%** and **conference proceedings was around 10%**. 
* **Citations per paper** for closed publication were **10**; while for **green or gold OA publications** were around **20**. 
* Scopus updates its data constantly. The data retrieved on March 1st and March 3rd using the same query were a little bit different. Next month, I will try to use the **Scopus API** to track the OA status and citations for the data set of 10,498 records (retrieved on March 1st, 2022). 

The following table shows the count and percentage by OA status and year.

```{r, echo=FALSE}
# install.packages("qwraps2") # not used
# install.packages("gt") # not used
# install.packages("pivottabler")

library(tidyverse)
library(pivottabler)

oa_stats_march <- read_csv("data/oa_stats_20220301_clean.csv")

# qhpvt(oa_stats_march, c("is_oa","oa_status"), "Year", "n()") this code works for count, but not for percentage

oa4pivot <- oa_stats_march %>% 
  group_by(Year) %>% 
  count(is_oa, oa_status) %>%  
  mutate(percent = 100*n/sum(n)) %>%   # calculate the percentage
  ungroup() 

oa4pivot$is_oa <- as.character(oa4pivot$is_oa)  #convert is_oa from logic to character

oa4pivot %>%   
  qhpvt(
    c("is_oa","oa_status"), 
    "Year", 
    c("Count" = "sum(n)", "%" = "sum(percent)"),
    formats = list("%.0f", "%.2f"),
    totals = list("is_oa" = "Total", "oa_status" = "Total"),
    totalStyle = list("font-weight"="bold")
    )

# not sure how to remove the Total column for Year
# pt <- PivotTable$new()
# pt$addData(oa4pivot)
# pt$addColumnDataGroups("Year")
# pt$addRowDataGroups("is_oa", 
#                     outlineTotal=list(groupStyleDeclarations=list(color="black")))
# pt$addRowDataGroups("oa_status",
#                     outlineTotal=list(groupStyleDeclarations=list(color="black")))
# pt$defineCalculation(calculationName = "count", summariseExpression = "sum(n)")
# pt$defineCalculation(calculationName = "%", summariseExpression = "round(sum(percent))")
# pt$renderPivot()

```
The table below showed the citations per paper by OA status and year: 
```{r echo=FALSE}
citations <- oa_stats_march
citations$Cited_by[is.na(citations$Cited_by) == TRUE] <- 0
citations$is_oa <- as.character(citations$is_oa)  #convert is_oa from logic to character

citations %>% 
  group_by(Year, oa_status) %>% 
  mutate(citations_per_paper = round(sum(Cited_by)/n())) %>%   # added a new column the citations per paper
  select(Year, is_oa, oa_status, Cited_by, citations_per_paper) %>%  
  ungroup() %>%  
  qhpvt(
    c("is_oa", "oa_status"), 
    "Year", 
    c("Count" = "n()", "Citations Per Paper" = "sum(citations_per_paper)/n()"),
    formats = list("%.0f", "%.0f"),
    totals = list("oa_status" = "Total", "Year" = "Total"),
    totalStyle = list("font-weight"="bold")
    )


```

# Web Stats - Comparing Jan and Feb of the four years from 2019 to 2022

## Findings - from Google Analytics
**The overall usage of website increases comparing with the same time period of 2021, but has not come back to the level of 2019 and 2020 (pre-pandemic). **

**Home page clicks - The label [object HTMLDivElement]tab_overlay[object Object] takes over 7% of the clicks but I could not identify the element. Probably this label is for some spots on the search boxes. If true, the search box area got over 60% of the clicks. Need to follow up with this label. **


* Browsers: 65-70% sessions used Chrome; usage of Safari was slightly increased
* Channels: The percentage of sessions which came through organic searches increased from 43% to 60% in 2021 and 58% in 2022. Even before COVID-19, we saw increased use of organic search to the library web pages. The pandemic accelerated this trend. 
* Devices: Sessions using desktop have gradually moved to mobile during 2019 through 2021. But 2022 witnessed a jump from 9% to 13% in mobile and a drop from 90% to 84% in desktop. Will follow up to see if it is a new trend. 

```{r echo=FALSE}

pageviews <- read_csv("data/pageviews.csv")

# pageviews %>% 
#   qhpvt("Name", "Year", "sum(Pageviews)")


pt <- PivotTable$new()
pt$addData(pageviews)
pt$addColumnDataGroups("Year")
pt$addRowDataGroups("Name", 
                    outlineTotal=list(groupStyleDeclarations=list(color="black")))
pt$defineCalculation(calculationName = "TotalViews", summariseExpression = "sum(Pageviews)")
pt$sortRowDataGroups(
  levelNumber = 1,
  orderBy = "calculation",
  sortOrder = "desc",
  calculationGroupName = "default"
)
#pt$asDataFrame()
pt$renderPivot()


```

## Findings - From Google Business Profile
* The library profile received 4 reviews on Google Reviews - two 5-star and two 4-star ratings
* profile views: Jan - 17,910; Feb - 24,093. Will keep tracking the profile views.

